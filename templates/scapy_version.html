<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WIDS Dashboard</title>
    <script>
        async function fetchStats() {
            const response = await fetch('/system-stats');
            const stats = await response.json();

            document.getElementById('disk-usage').innerText = `${stats.disk.used} GB / ${stats.disk.total} GB (${stats.disk.percent}%)`;
            document.getElementById('ram-usage').innerText = `${stats.memory.used} GB / ${stats.memory.total} GB (${stats.memory.percent}%)`;
            document.getElementById('cpu-usage').innerText = `${stats.cpu.percent}%`;
        }

        async function fetchPackets() {
            const response = await fetch('/packets');
            const data = await response.json();
            const packets = data.packets;
            const totalPackets = data.total_packets;

            document.getElementById('total-packets').innerText = totalPackets;

            const packetList = document.getElementById('packet-list');
            packetList.innerHTML = '';

            packets.forEach(packet => {
                const item = document.createElement('li');
                item.innerText = `Source: ${packet.src_mac}, Destination: ${packet.dst_mac}, Count: ${packet.count}, Reason: ${packet.reason_code}, Time: ${packet.time}`;
                packetList.appendChild(item);
            });
        }

        async function setMonitorMode(event) {
            event.preventDefault();
            const interface = document.getElementById('interface').value;

            const response = await fetch('/set_monitor', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ interface }),
            });

            const result = await response.json();
            alert(result.message);
        }

        async function startSniffing(event) {
            event.preventDefault();
            const interface = document.getElementById('interface').value;

            const response = await fetch('/start_sniffing', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ interface }),
            });

            const result = await response.json();
            alert(result.message);
        }

        function refreshData() {
            fetchStats();
            fetchPackets();
        }

        window.onload = function () {
            refreshData();
            setInterval(refreshData, 5000);
        };
    </script>
</head>
<body>
    <header>
        <h1>Wireless Intrusion Detection System (WIDS)</h1>
    </header>
    <main>
        <section>
            <h2>Control Panel</h2>
            <form id="monitor-form" onsubmit="setMonitorMode(event)">
                <label for="interface">Interface:</label>
                <input type="text" id="interface" name="interface" placeholder="e.g., wlan1" required>
                <button type="submit">Set Monitor Mode</button>
            </form>

            <form id="sniff-form" onsubmit="startSniffing(event)">
                <button type="submit">Start Sniffing</button>
            </form>
        </section>

        <section>
            <h2>System Stats</h2>
            <p><strong>Disk Usage:</strong> <span id="disk-usage">Loading...</span></p>
            <p><strong>RAM Usage:</strong> <span id="ram-usage">Loading...</span></p>
            <p><strong>CPU Usage:</strong> <span id="cpu-usage">Loading...</span></p>
        </section>

        <section>
            <h2>Packet Analysis</h2>
            <p><strong>Total Packets Processed:</strong> <span id="total-packets">0</span></p>
            <ul id="packet-list">
                <li>Loading captured packets...</li>
            </ul>
        </section>
    </main>
</body>
</html>
